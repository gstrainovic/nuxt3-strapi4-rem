<style></style>

<template>
  <section class="faq__area p-relative z-index-1 pt-120 pb-105">
    <div class="container">
      <div class="row">
        <div class="col-xxl-5 col-xl-5 col-lg-6">
          <div class="faq__wrapper">
            <div class="section__title-wrapper-7 mb-60">
              <span class="section__title-pre-7">Tab Accordion</span>
              <h3 class="section__title-7">Accordion <br> with
                <span class="section__title-7-highlight">
                  rounded tab
                  <svg width="240" height="22" viewBox="0 0 240 22" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M0.440833 21.1152C78.9497 6.16225 158.05 4.53412 235.949 13.8239C237.497 14.0088 239.796 12.4065 239.988 9.93474C240.181 7.4176 238.026 5.44088 236.474 5.2332C157.99 -5.31675 79.1936 0.359501 0.316568 19.7785C-0.184784 19.9023 -0.0511379 21.2092 0.440833 21.1152Z"
                      fill="#2CAE76" />
                  </svg>
                </span>
              </h3>
            </div>

            <div class="faq__tab tp-tab pr-200">
              <nav>
                <div class="nav nav-tabs flex-column" id="nav-tab" role="tablist">

                  <button class="nav-link active" id="nav-general-tab-2" data-bs-toggle="tab"
                    data-bs-target="#nav-general" type="button" role="tab" aria-controls="nav-general"
                    aria-selected="true">
                    <span>
                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                          d="M7.318 1.74134L2.467 5.52653C1.657 6.1574 1 7.50024 1 8.51863V15.1968C1 17.2877 2.701 19 4.789 19H15.211C17.299 19 19 17.2877 19 15.2058V8.6448C19 7.55431 18.271 6.1574 17.38 5.53554L11.818 1.63319C10.558 0.749983 8.533 0.795045 7.318 1.74134Z"
                          stroke="#525258" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M10 15.3951V12.6914" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                          stroke-linejoin="round" />
                      </svg>
                    </span>
                    General Questions
                  </button>

                  <!--  create a loop here from the grouped_service_details_with_category_id  -->
                  <!-- use the category id to create the tab and the service details to create the accordion -->
                  <!-- use the button template below to create the tab and the accordion, change all necessary ids and aria-controls -->
                  <div v-if="gsd">
                    <template v-for="c in gsd" :key="c.category_id">
                      <button class="nav-link" :id="'nav-' + c.category_id + 'tab'" data-bs-toggle="tab"
                        :data-bs-target="'#nav-' + c.category_id" type="button" role="tab"
                        :aria-controls="'nav-' + c.category_id" aria-selected="true">
                        <span>
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M7.318 1.74134L2.467 5.52653C1.657 6.1574 1 7.50024 1 8.51863V15.1968C1 17.2877 2.701 19 4.789 19H15.211C17.299 19 19 17.2877 19 15.2058V8.6448C19 7.55431 18.271 6.1574 17.38 5.53554L11.818 1.63319C10.558 0.749983 8.533 0.795045 7.318 1.74134Z"
                              stroke="#525258" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M10 15.3951V12.6914" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round" />
                          </svg>
                        </span>
                        {{ c.category }}
                      </button>
                    </template>
                  </div>
                </div>
              </nav>
            </div>
          </div>
        </div>
        <div class="col-xxl-7 col-xl-7 col-lg-6">
          <div class="faq__tab-content tp-accordion">
            <div class="tab-content" id="nav-tabContent-2">

              <div class="tab-pane fade show active" id="nav-general" role="tabpanel" aria-labelledby="nav-general-tab-2">
                <div class="accordion" id="general_accordion">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="search">
                      <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapsesearch" aria-expanded="true" aria-controls="collapsesearch">
                        Global search engine optimization
                      </button>
                    </h2>
                    <div id="collapsesearch" class="accordion-collapse collapse" aria-labelledby="search"
                      data-bs-parent="#general_accordion">
                      <div class="accordion-body">
                        <p>A startup or start-up is started by individual founders or entrepreneurs to search for a
                          repeatable and scalable business model. A startup or start-up is started by individual
                          founders...</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- create a loop here from the grouped_service_details_with_category_id  -->
              <!-- use the category id to create service details to create the accordion -->
              <!-- use the template above to create the accordion, change all necessary ids and aria-controls -->
              <div v-if="gsd">
                <template v-for="c in gsd" :key="c.category_id">
                  <div v-if="c.items.length > 0">
                    <div class="tab-pane fade" :id="'nav-' + c.category_id" role="tabpanel"
                      :aria-labelledby="'nav-' + c.category_id + 'tab'">
                      <div class="accordion" :id="'accordion-' + c.category_id">
                        <div class="accordion-item" v-for="item in c.items" :key="item.id">
                          <h2 class="accordion-header" :id="'heading-' + item.id">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                              :data-bs-target="'#collapse-' + item.id" aria-expanded="false"
                              :aria-controls="'collapse-' + item.id">
                              {{ item.attributes.Title }}
                            </button>
                          </h2>
                          <div :id="'collapse-' + item.id" class="accordion-collapse collapse"
                            :aria-labelledby="'heading-' + item.id" :data-bs-parent="'#accordion-' + c.category_id">
                            <div class="accordion-body">
                              {{ item.attributes.Description }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</template>

<script setup lang="ts">
import TabContent from '~~/components/faqs/StartUpFaq/TabContent.vue';
import { Strapi4ResponseData, StrapiLocale } from "@nuxtjs/strapi/dist/runtime/types";
import { ServiceDetail } from "~/types/service";

const { locale } = useI18n()
const { find } = useStrapi()

const service_details = await find<ServiceDetail>('service-details', {
  locale: locale.value as StrapiLocale,
})

// group service_details by category like this:
// [ { category: 'category1', items: [ { title: 'title1', description: 'description1' }, { title: 'title2', description: 'description2' } ] }, { category: 'category2', items: [ { title: 'title3', description: 'description3' }, { title: 'title4', description: 'description4' } ] } ]
const grouped_service_details: { category: string; items: Strapi4ResponseData<ServiceDetail>[] }[] = service_details.data.reduce((acc: { category: string; items: Strapi4ResponseData<ServiceDetail>[] }[], item: Strapi4ResponseData<ServiceDetail>) => {
  const category: string = item.attributes.Category
  const existing_category: { category: string; items: Strapi4ResponseData<ServiceDetail>[] } | undefined = acc.find((i) => i.category === category)
  if (existing_category) {
    existing_category.items.push(item)
  } else {
    acc.push({ category, items: [item] })
  }
  return acc
}, [])

//add category_id like this item.attributes.Category.replace(/[^a-zA-Z0-9]/g, '') on grouped_service_details
const gsd = grouped_service_details.map((item) => {
  return {
    category: item.category,
    category_id: item.category.replace(/[^a-zA-Z0-9]/g, ''),
    items: item.items
  }
})


</script>
